; Note This File should be rewritten to head.S (GNU)

CODE_SEL equ 0x0008
DATA_SEL equ 0x0010
SCRN_SEL equ 0x0018

[bits 32]

;##############################################################################
;################################### INIT #####################################
;##############################################################################

segment .text
		global init
		extern main

page_dir:
init:
		mov ax, DATA_SEL
		mov ds, ax
		mov ss, ax
		mov esp, init_stack 
		call load_gdt
		call flush_sreg
		call main
spin:
		jmp spin

load_gdt:
		lgdt ds:[gdt_48]
		ret

flush_sreg:
		mov ax, DATA_SEL	
		mov ds, ax
		mov ss, ax
		mov es, ax
		mov fs, ax
		mov gs, ax
		ret
		
;##############################################################################
;############################### INIT STACK ###################################
;##############################################################################

align 4

		times 1024*20 db 0
init_stack:

;##############################################################################
;################################## GDT #######################################
;##############################################################################

gdt_48:
		dw 256*8-1
		dd gdt

align 8

gdt:
		dw 0, 0, 0, 0
		dw 0xffff, 0x0000, 0x9a00, 0x00cf
		dw 0xffff, 0x0000, 0x9200, 0x00cf
		dw 0x0002, 0x8000, 0x920b, 0x00c0
		times 256*8-($-gdt) db 0

;##############################################################################
;################################## END #######################################
;##############################################################################
